{% extends "base.html" %}

{% block title %}PDF Tools{% endblock %}
{% block nav_pdf %}active{% endblock %}

{% block content %}
    <main>

        <!-- Merge -->
        <div id="tab-merge" class="pdf-section card active">
            <div class="card-body">
                <h2>Merge PDFs</h2>
                <p class="meta">Combine multiple PDF files into one. Drag to reorder.</p>

                <div class="drop-zone" id="merge-drop">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="12" y1="18" x2="12" y2="12"/>
                        <polyline points="9 15 12 12 15 15"/>
                    </svg>
                    <label class="drop-browse">Select PDF files<input type="file" id="merge-input" accept=".pdf" multiple hidden></label>
                    <p class="drop-hint">or drop files here &middot; add as many as you like &middot; drag to reorder</p>
                </div>

                <div id="merge-list" class="file-list"></div>

                <div id="merge-actions" class="pdf-actions" hidden>
                    <button id="merge-btn" class="btn-download" onclick="doMerge()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"><path d="M12 3v14M5 12l7 7 7-7"/><path d="M5 21h14"/></svg>
                        Merge PDFs
                    </button>
                </div>

                <div id="merge-error" class="error" hidden></div>
            </div>
        </div>

        <!-- Split -->
        <div id="tab-split" class="pdf-section card">
            <div class="card-body">
                <h2>Split PDF</h2>
                <p class="meta">Split a PDF into separate pages or custom ranges.</p>

                <div class="drop-zone" id="split-drop">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="12" y1="18" x2="12" y2="12"/>
                        <polyline points="9 15 12 12 15 15"/>
                    </svg>
                    <label class="drop-browse">Select PDF file<input type="file" id="split-input" accept=".pdf" hidden></label>
                    <p class="drop-hint">or drop a file here &middot; leave ranges empty to split every page</p>
                </div>

                <div id="split-file-info" class="split-info" hidden>
                    <span id="split-file-name" class="split-name"></span>
                    <span id="split-page-count" class="count-badge"></span>
                    <button class="split-remove" onclick="clearSplitFile()">&times;</button>
                </div>

                <div id="split-options" hidden>
                    <div class="field" style="margin-top: 16px;">
                        <label>Page ranges (leave empty to split all pages)</label>
                        <input type="text" id="split-ranges" placeholder="e.g. 1-3, 5, 7-10">
                    </div>
                </div>

                <div id="split-actions" class="pdf-actions" hidden>
                    <button id="split-btn" class="btn-download" onclick="doSplit()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"><path d="M12 3v14M5 12l7 7 7-7"/><path d="M5 21h14"/></svg>
                        Split PDF
                    </button>
                </div>

                <div id="split-error" class="error" hidden></div>
            </div>
        </div>

        <!-- Images to PDF -->
        <div id="tab-img2pdf" class="pdf-section card">
            <div class="card-body">
                <h2>Images to PDF</h2>
                <p class="meta">Convert images to a single PDF document. Drag to reorder.</p>

                <div class="drop-zone" id="img-drop">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square">
                        <rect x="3" y="3" width="18" height="18" rx="2" ry="2"/>
                        <circle cx="8.5" cy="8.5" r="1.5"/>
                        <polyline points="21 15 16 10 5 21"/>
                    </svg>
                    <label class="drop-browse">Select images<input type="file" id="img-input" accept="image/jpeg,image/png,image/webp" multiple hidden></label>
                    <p class="drop-hint">or drop files here &middot; JPG, PNG, WebP &middot; drag to reorder</p>
                </div>

                <div id="img-list" class="file-list"></div>

                <div id="img-actions" class="pdf-actions" hidden>
                    <button id="img-btn" class="btn-download" onclick="doImagesToPdf()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"><path d="M12 3v14M5 12l7 7 7-7"/><path d="M5 21h14"/></svg>
                        Convert to PDF
                    </button>
                </div>

                <div id="img-error" class="error" hidden></div>
            </div>
        </div>
        <!-- Compress -->
        <div id="tab-compress" class="pdf-section card">
            <div class="card-body">
                <h2>Compress PDF</h2>
                <p class="meta">Reduce PDF file size by compressing content streams.</p>

                <div class="drop-zone" id="compress-drop">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                    </svg>
                    <label class="drop-browse">Select PDF file<input type="file" id="compress-pdf-input" accept=".pdf" hidden></label>
                    <p class="drop-hint">or drop a file here &middot; compresses streams &middot; removes redundant data</p>
                </div>

                <div id="compress-pdf-info" class="split-info" hidden>
                    <span id="compress-pdf-name" class="split-name"></span>
                    <span id="compress-pdf-size" class="file-size"></span>
                    <button class="split-remove" onclick="clearCompressPdf()">&times;</button>
                </div>

                <div id="compress-pdf-actions" class="pdf-actions" hidden>
                    <button id="compress-pdf-btn" class="btn-download" onclick="doCompressPdf()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"><path d="M12 3v14M5 12l7 7 7-7"/><path d="M5 21h14"/></svg>
                        Compress PDF
                    </button>
                </div>
                <div id="compress-pdf-error" class="error" hidden></div>
            </div>
        </div>

        <!-- Extract Text -->
        <div id="tab-totext" class="pdf-section card">
            <div class="card-body">
                <h2>Extract Text</h2>
                <p class="meta">Pull all text content from a PDF into a plain text file.</p>

                <div class="drop-zone" id="totext-drop">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <line x1="8" y1="13" x2="16" y2="13"/>
                        <line x1="8" y1="17" x2="16" y2="17"/>
                        <polyline points="10 9 9 9 8 9"/>
                    </svg>
                    <label class="drop-browse">Select PDF file<input type="file" id="totext-input" accept=".pdf" hidden></label>
                    <p class="drop-hint">or drop a file here &middot; outputs a .txt file with page separators</p>
                </div>

                <div id="totext-file-info" class="split-info" hidden>
                    <span id="totext-file-name" class="split-name"></span>
                    <span id="totext-file-size" class="file-size"></span>
                    <button class="split-remove" onclick="clearTotextFile()">&times;</button>
                </div>

                <div id="totext-actions" class="pdf-actions" hidden>
                    <button id="totext-btn" class="btn-download" onclick="doToText()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"><path d="M12 3v14M5 12l7 7 7-7"/><path d="M5 21h14"/></svg>
                        Extract Text
                    </button>
                </div>
                <div id="totext-error" class="error" hidden></div>
            </div>
        </div>

        <!-- Password -->
        <div id="tab-password" class="pdf-section card">
            <div class="card-body">
                <h2>PDF Password</h2>
                <p class="meta">Add or remove password protection from a PDF.</p>

                <div class="pdf-tabs" style="margin-top:0; margin-bottom:16px;">
                    <button class="pdf-tab active" data-subtab="addpw">Add Password</button>
                    <button class="pdf-tab" data-subtab="removepw">Remove Password</button>
                </div>

                <!-- Add password -->
                <div id="subtab-addpw" class="pdf-subsection">
                    <div class="drop-zone" id="addpw-drop">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                            <path d="M7 11V7a5 5 0 0110 0v4"/>
                        </svg>
                        <label class="drop-browse">Select PDF file<input type="file" id="addpw-input" accept=".pdf" hidden></label>
                        <p class="drop-hint">or drop a file here &middot; enter a password below to protect it</p>
                    </div>
                    <div id="addpw-file-info" class="split-info" hidden>
                        <span id="addpw-file-name" class="split-name"></span>
                        <span id="addpw-file-size" class="file-size"></span>
                        <button class="split-remove" onclick="clearAddPwFile()">&times;</button>
                    </div>
                    <div id="addpw-options" hidden style="margin-top:16px;">
                        <div class="field">
                            <label>Password</label>
                            <input type="password" id="addpw-password" placeholder="Enter password to set">
                        </div>
                    </div>
                    <div id="addpw-actions" class="pdf-actions" hidden>
                        <button id="addpw-btn" class="btn-download" onclick="doAddPassword()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"><path d="M12 3v14M5 12l7 7 7-7"/><path d="M5 21h14"/></svg>
                            Protect PDF
                        </button>
                    </div>
                    <div id="addpw-error" class="error" hidden></div>
                </div>

                <!-- Remove password -->
                <div id="subtab-removepw" class="pdf-subsection" hidden>
                    <div class="drop-zone" id="removepw-drop">
                        <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square">
                            <rect x="3" y="11" width="18" height="11" rx="2" ry="2"/>
                            <path d="M7 11V7a5 5 0 0110 0v4"/>
                        </svg>
                        <label class="drop-browse">Select PDF file<input type="file" id="removepw-input" accept=".pdf" hidden></label>
                        <p class="drop-hint">or drop a file here &middot; enter the current password to unlock it</p>
                    </div>
                    <div id="removepw-file-info" class="split-info" hidden>
                        <span id="removepw-file-name" class="split-name"></span>
                        <span id="removepw-file-size" class="file-size"></span>
                        <button class="split-remove" onclick="clearRemovePwFile()">&times;</button>
                    </div>
                    <div id="removepw-options" hidden style="margin-top:16px;">
                        <div class="field">
                            <label>Current Password</label>
                            <input type="password" id="removepw-password" placeholder="Enter the existing password">
                        </div>
                    </div>
                    <div id="removepw-actions" class="pdf-actions" hidden>
                        <button id="removepw-btn" class="btn-download" onclick="doRemovePassword()">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"><path d="M12 3v14M5 12l7 7 7-7"/><path d="M5 21h14"/></svg>
                            Unlock PDF
                        </button>
                    </div>
                    <div id="removepw-error" class="error" hidden></div>
                </div>
            </div>
        </div>
        <!-- Rotate Pages -->
        <div id="tab-rotatepages" class="pdf-section card">
            <div class="card-body">
                <h2>Rotate Pages</h2>
                <p class="meta">Rotate all or specific pages of a PDF by 90°, 180°, or 270°.</p>

                <div class="drop-zone" id="rotatepages-drop">
                    <svg width="48" height="48" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="square">
                        <path d="M14 2H6a2 2 0 00-2 2v16a2 2 0 002 2h12a2 2 0 002-2V8z"/>
                        <polyline points="14 2 14 8 20 8"/>
                        <polyline points="23 4 23 10 17 10"/>
                        <path d="M20.49 15a9 9 0 11-2.12-9.36L23 10"/>
                    </svg>
                    <label class="drop-browse">Select PDF file<input type="file" id="rotatepages-input" accept=".pdf" hidden></label>
                    <p class="drop-hint">or drop a file here &middot; choose angle and optionally target specific pages</p>
                </div>

                <div id="rotatepages-file-info" class="split-info" hidden>
                    <span id="rotatepages-file-name" class="split-name"></span>
                    <span id="rotatepages-page-count" class="count-badge"></span>
                    <button class="split-remove" onclick="clearRotatePagesFile()">&times;</button>
                </div>

                <div id="rotatepages-options" hidden>
                    <div class="control-row" style="margin-top: 16px;">
                        <div class="select-wrap">
                            <label>Angle</label>
                            <select id="rotatepages-angle">
                                <option value="90">90° clockwise</option>
                                <option value="180">180°</option>
                                <option value="270">270° clockwise (90° CCW)</option>
                            </select>
                        </div>
                    </div>
                    <div class="field" style="margin-top: 12px;">
                        <label>Pages (leave empty to rotate all)</label>
                        <input type="text" id="rotatepages-pages" placeholder="e.g. 1, 3, 5-7">
                    </div>
                </div>

                <div id="rotatepages-actions" class="pdf-actions" hidden>
                    <button id="rotatepages-btn" class="btn-download" onclick="doRotatePages()">
                        <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5" stroke-linecap="square"><path d="M12 3v14M5 12l7 7 7-7"/><path d="M5 21h14"/></svg>
                        Rotate Pages
                    </button>
                </div>

                <div id="rotatepages-error" class="error" hidden></div>
            </div>
        </div>
    </main>
{% endblock %}

{% block scripts %}
    <script src="/static/pdf.js?v={{ version }}"></script>
{% endblock %}
